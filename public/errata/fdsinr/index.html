<!doctype html>

<html lang="en">

<head><script src="/livereload.js?mindelay=10&amp;v=2&amp;port=1313&amp;path=livereload" data-no-instant defer></script>
  <title>Mailund on the Internet</title>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="description" content="The HTML5 Herald" />
  <meta name="author" content="" />
  

  <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.3.1/css/all.css" integrity="sha384-mzrmE5qonljUremFsqc01SB46JvROS7bZs3IO2EmfFsd15uHvIt+Y8vEf7N7fWAU" crossorigin="anonymous">

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/normalize/7.0.0/normalize.min.css" />

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css" />

<link rel="stylesheet" type="text/css" href="http://localhost:1313/css/styles.css" />
<link rel="stylesheet" href="https://cdn.rawgit.com/tonsky/FiraCode/1.205/distr/fira_code.css">

 
       <link rel="stylesheet" href="//fonts.googleapis.com/css?family=Droid Sans" type="text/css" media="all" />
     
       <link rel="stylesheet" href="//fonts.googleapis.com/css?family=Fira Mono" type="text/css" media="all" />
     

 <style>
 body {
     font-family: 'Droid Sans';
 }
 code {
    font-family: 'Fira Code';
 }
 </style>

 <script type="text/javascript" async
   src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML">
   MathJax.Hub.Queue(function() {
     
     
     
     var all = MathJax.Hub.getAllJax(), i;
     for(i = 0; i < all.length; i += 1) {
         all[i].SourceElement().parentNode.className += ' has-jax';
     }
   });

   MathJax.Hub.Config({
   
   TeX: { equationNumbers: { autoNumber: "AMS" } }
   });
   MathJax.Hub.Config({
   tex2jax: {
     inlineMath: [['$$','$$'], ['\\(','\\)']],
     displayMath: [['$$$','$$$']],
     processEscapes: true,
     processEnvironments: true,
     skipTags: ['script', 'noscript', 'style', 'textarea', 'pre'],
     TeX: { equationNumbers: { autoNumber: "AMS" },
          extensions: ["AMSmath.js", "AMSsymbols.js"] }
   }
   });
 </script>

      <script async src="https://www.googletagmanager.com/gtag/js?id=386493837"></script>
      <script>
        var doNotTrack = false;
        if ( false ) {
          var dnt = (navigator.doNotTrack || window.doNotTrack || navigator.msDoNotTrack);
          var doNotTrack = (dnt == "1" || dnt == "yes");
        }
        if (!doNotTrack) {
          window.dataLayer = window.dataLayer || [];
          function gtag(){dataLayer.push(arguments);}
          gtag('js', new Date());
          gtag('config', '386493837');
        }
      </script>
</head>

<body>
  <div id="container">
    <header>
      <h1>
                <a href="http://localhost:1313/">Mailund on the Internet</a>
            </h1>

      <ul id="social-media">
                
      </ul>
      
      <p><em>On Writing, Science, Programming and more</em></p>
      

    </header>

    
<nav>
    <ul>
        
        <li>
            <a class="" href="http://localhost:1313/about/">
                <i class="fa-li fa  fa-lg"></i><span>About</span>
            </a>
        </li>
        
        <li>
            <a class="" href="http://localhost:1313/posts">
                <i class="fa-li fa  fa-lg"></i><span>Posts</span>
            </a>
        </li>
        
        <li>
            <a class="" href="http://localhost:1313/books/">
                <i class="fa-li fa  fa-lg"></i><span>Books</span>
            </a>
        </li>
        
        <li>
            <a class="" href="http://localhost:1313/fiction/">
                <i class="fa-li fa  fa-lg"></i><span>Fiction</span>
            </a>
        </li>
        
        <li>
            <a class="" href="http://localhost:1313/publications/">
                <i class="fa-li fa  fa-lg"></i><span>Publications</span>
            </a>
        </li>
        
        <li>
            <a class="" href="http://localhost:1313/software/">
                <i class="fa-li fa  fa-lg"></i><span>Software</span>
            </a>
        </li>
        
    </ul>
</nav>

    <main>




<article>

    <h1>Errata: Functional Data-Structures in R</h1>

    
        <aside>
    <ul>
        <li>
            <time class="post-date" datetime="2018-09-09T00:00:00Z">Sep 9, 2018</time>
        </li>
        
        

        
        <li>
            <em>
                
                    
                    <a href="http://localhost:1313/tags/books/">#books</a>
                
                    , 
                    <a href="http://localhost:1313/tags/writing/">#writing</a>
                
                    , 
                    <a href="http://localhost:1313/tags/functional-programming/">#functional-programming</a>
                
                    , 
                    <a href="http://localhost:1313/tags/rstats/">#rstats</a>
                
                    , 
                    <a href="http://localhost:1313/tags/errata/">#errata</a>
                
            </em>
        </li>
        

        <li>2 min read</li>
    </ul>
</aside>
    

    <p>One big regret I have about this book is that I didn’t implement the pattern matching code from <a href="https://amzn.to/2QHMNLL"><em>Domain-Specific Languages in R</em></a> before this book. Pattern matching makes implementing data structures <em>much</em> easier.</p>
<p>In the errata below, I will use it. You can read a description of how it works <a href="https://mailund.github.io/pmatch/">here</a>.</p>
<p>To use it, install the <code>patch</code> package and load it</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-r" data-lang="r"><span style="display:flex;"><span>install.packages(<span style="color:#00f">&#34;pmatch&#34;</span>)
</span></span><span style="display:flex;"><span>library(pmatch)
</span></span></code></pre></div><h2 id="chapter-4">Chapter 4</h2>
<h3 id="deques">Deques</h3>
<p>This section is just, well, wrong. I made a mistake in the implementation, but it was cancelled out by another error, so it didn’t affect the correctness—so my tests didn’t catch it. It did break the runtime guarantees, though, and my explanation of why that happens is also incorrect.</p>
<p>A correct implementation of <code>deques</code> (to the best of my knowledge), is this:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-r" data-lang="r"><span style="display:flex;"><span>queue := QUEUE(front_len, front, back_len, back)
</span></span><span style="display:flex;"><span>new_queue &lt;- <span style="color:#000080;font-weight:bold">function</span>() QUEUE(<span style="color:#00f">0</span>, NIL, <span style="color:#00f">0</span>, NIL)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>enqueue &lt;- <span style="color:#000080;font-weight:bold">function</span>(queue, x)
</span></span><span style="display:flex;"><span>  cases(queue,
</span></span><span style="display:flex;"><span>        QUEUE(front_len, front, back_len, back) -&gt;
</span></span><span style="display:flex;"><span>          QUEUE(front_len, front, back_len + <span style="color:#00f">1</span>, CONS(x, back)))
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>enqueue_front &lt;- <span style="color:#000080;font-weight:bold">function</span>(queue, x)
</span></span><span style="display:flex;"><span>  cases(queue,
</span></span><span style="display:flex;"><span>        QUEUE(front_len, front, back_len, back) -&gt;
</span></span><span style="display:flex;"><span>          QUEUE(front_len + <span style="color:#00f">1</span>, CONS(x, front), back_len, back))
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>split_list &lt;- <span style="color:#000080;font-weight:bold">function</span>(lst, n, acc = NIL)
</span></span><span style="display:flex;"><span>  cases(..(n, lst),
</span></span><span style="display:flex;"><span>        ..(<span style="color:#00f">0</span>, lst) -&gt; PAIR(reverse(acc), lst),
</span></span><span style="display:flex;"><span>        ..(n, CONS(car, cdr)) -&gt; split_list(cdr, n - <span style="color:#00f">1</span>, CONS(car, acc)))
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>move_front_to_back &lt;- <span style="color:#000080;font-weight:bold">function</span>(queue)
</span></span><span style="display:flex;"><span>  cases(queue,
</span></span><span style="display:flex;"><span>        QUEUE(front_len, front, <span style="color:#00f">0</span>, NIL) -&gt; {
</span></span><span style="display:flex;"><span>          n &lt;- floor(front_len / <span style="color:#00f">2</span>)
</span></span><span style="display:flex;"><span>          cases(split_list(front, n),
</span></span><span style="display:flex;"><span>                PAIR(first, second) -&gt;
</span></span><span style="display:flex;"><span>                  QUEUE(n,
</span></span><span style="display:flex;"><span>                        first,
</span></span><span style="display:flex;"><span>                        front_len - n,
</span></span><span style="display:flex;"><span>                        reverse(second)))
</span></span><span style="display:flex;"><span>          })
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>move_back_to_front &lt;- <span style="color:#000080;font-weight:bold">function</span>(queue)
</span></span><span style="display:flex;"><span>  cases(queue,
</span></span><span style="display:flex;"><span>        QUEUE(<span style="color:#00f">0</span>, NIL, back_len, back) -&gt; {
</span></span><span style="display:flex;"><span>          n &lt;- floor(back_len / <span style="color:#00f">2</span>)
</span></span><span style="display:flex;"><span>          cases(split_list(back, n),
</span></span><span style="display:flex;"><span>                PAIR(first, second) -&gt;
</span></span><span style="display:flex;"><span>                  QUEUE(back_len - n, reverse(second), n, first))
</span></span><span style="display:flex;"><span>        })
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>front &lt;- <span style="color:#000080;font-weight:bold">function</span>(queue)
</span></span><span style="display:flex;"><span>  cases(queue,
</span></span><span style="display:flex;"><span>        QUEUE(., NIL, ., NIL)        -&gt; stop(<span style="color:#00f">&#34;Empty queue&#34;</span>),
</span></span><span style="display:flex;"><span>        QUEUE(., NIL, ., .)          -&gt; front(move_back_to_front(queue)),
</span></span><span style="display:flex;"><span>        QUEUE(front_len, CONS(car, cdr), back_len, back) -&gt;
</span></span><span style="display:flex;"><span>          PAIR(car, QUEUE(front_len - <span style="color:#00f">1</span>, cdr, back_len, back)))
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>back &lt;- <span style="color:#000080;font-weight:bold">function</span>(queue)
</span></span><span style="display:flex;"><span>  cases(queue,
</span></span><span style="display:flex;"><span>        QUEUE(., NIL, ., NIL)        -&gt; stop(<span style="color:#00f">&#34;Empty queue&#34;</span>),
</span></span><span style="display:flex;"><span>        QUEUE(., ., ., NIL)          -&gt; back(move_front_to_back(queue)),
</span></span><span style="display:flex;"><span>        QUEUE(front_len, front, back_len, CONS(car, cdr)) -&gt;
</span></span><span style="display:flex;"><span>          PAIR(car, QUEUE(front_len, front, back_len - <span style="color:#00f">1</span>, cdr)))   
</span></span></code></pre></div><p>The cost of splitting a list and moving a list is bounded by <code>2n</code></p>
<p><img src="split-cost.png" alt=""></p>
<p>so put two operations in the bank each time you increase the difference in list lengths and you can pay for it when you need to.</p>


</article>


<hr/>
<div id="disqus_thread"></div>
<script>
    window.disqus_config = function () {
    
    
    
    };
    (function() {
        if (["localhost", "127.0.0.1"].indexOf(window.location.hostname) != -1) {
            document.getElementById('disqus_thread').innerHTML = 'Disqus comments not available by default when the website is previewed locally.';
            return;
        }
        var d = document, s = d.createElement('script'); s.async = true;
        s.src = '//' + "mailund-dk" + '.disqus.com/embed.js';
        s.setAttribute('data-timestamp', +new Date());
        (d.head || d.body).appendChild(s);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="https://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
<hr/>
<section class="post-nav">
    <ul>
        
        
        <li>
            <a href="http://localhost:1313/errata/fpinr/">Errata: Functional Programming in R <i class="fa fa-chevron-circle-right"></i> </a>
        </li>
        
    </ul>
</section>
  





</main>
    <footer>
        <h6>Copyright © 2020-2025 - Thomas Mailund |
            Rendered by <a href="https://gohugo.io" title="Hugo">Hugo</a> |
            <a href="http://localhost:1313/index.xml">Subscribe</a></h6>
    </footer>
</div>
<script src="http://localhost:1313/js/scripts.js"></script>
</body>
<div id="amzn-assoc-ad-04956520-8388-43ab-9b6e-fbe758d208f8"></div>
<script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&adInstanceId=04956520-8388-43ab-9b6e-fbe758d208f8"></script>

<script type="text/javascript"
  src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML">
</script>

</html>
